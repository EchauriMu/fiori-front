<mvc:View
    controllerName="com.invertions.sapfiorimodinv.controller.presentaciones.EditPresentation"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:f="sap.ui.layout.form"
    xmlns:l="sap.ui.layout"
    xmlns:u="sap.ui.unified"
    xmlns:core="sap.ui.core">


    <Page
        id="editPresentationPage"
        title="{i18n>editPresentationTitle}"
        showSubHeader="true"
        showNavButton="true"
        navButtonPress=".onNavBack">
        <headerContent>
            <Button
                text="{= ${editModel>/isSubmitting} ? ${i18n>editPresentationSavingButton} : ${i18n>editPresentationSaveButton}}"
                type="Emphasized"
                press=".onSave"
                enabled="{= !${editModel>/isSubmitting} }" />
            <Button
                text="{i18n>editPresentationCancelButton}"
                press=".onNavBack"
                enabled="{= !${editModel>/isSubmitting} }" /> 
        </headerContent>
        <subHeader>
            <Toolbar>
                <Title
                    level="H5"
                    text="{= 'ID Presentación: ' + ${editModel>/presentationData/IdPresentaOK} }" />
            </Toolbar>
        </subHeader>

        <content>
            <BusyIndicator busy="{editModel>/isLoading}" class="sapUiMediumMarginTop" />
            <VBox visible="{= !${editModel>/isLoading} }">
                <f:SimpleForm
                    editable="true"
                    layout="ResponsiveGridLayout"
                    labelSpanXL="4" labelSpanL="3" labelSpanM="4" labelSpanS="12"
                    adjustLabelSpan="false"
                    emptySpanXL="0" emptySpanL="4" emptySpanM="0" emptySpanS="0"
                    columnsXL="2" columnsL="1" columnsM="1"
                    singleContainerFullSize="false">
                    <f:content>
                        <core:Title text="{i18n>editPresentationTitle}" xmlns:core="sap.ui.core" />
                        <Label text="ID Presentación" />
                        <Text text="{editModel>/presentationData/IdPresentaOK}" class="sapMObjectIdentifier" />

                        <Label text="{i18n>editPresentationNameLabel}" required="true" />
                        <Input
                            value="{editModel>/presentationData/NOMBREPRESENTACION}"
                            placeholder="{i18n>editPresentationNamePlaceholder}"
                            required="true" />

                        <Label text="{i18n>editPresentationDescLabel}" />
                        <TextArea
                            value="{editModel>/presentationData/Descripcion}"
                            placeholder="{i18n>editPresentationDescPlaceholder}"
                            rows="3" />

                        <Label text="{i18n>editPresentationActiveLabel}" />
                        <Switch state="{editModel>/presentationData/ACTIVED}" />

                        <core:Title text="{i18n>editPresentationPropsTitle}" xmlns:core="sap.ui.core" />
                        <Label text="{i18n>editPresentationPropKeyLabel}" />
                        <Input id="propKeyInput" value="{editModel>/newProperty/key}" placeholder="{i18n>editPresentationPropKeyPlaceholder}" />
                        <Label text="{i18n>editPresentationPropValueLabel}" />
                        <Input id="propValueInput" value="{editModel>/newProperty/value}" placeholder="{i18n>editPresentationPropValuePlaceholder}" />
                        <Label />
                        <Button
                            icon="sap-icon://add"
                            text="{i18n>editPresentationAddPropButton}"
                            press=".onAddProperty"
                            enabled="{= !!${editModel>/newProperty/key} }" />

                        <List
                            headerText="Propiedades añadidas"
                            items="{editModel>/propiedadesExtras}"
                            noDataText="Aún no hay propiedades extras">
                            <CustomListItem>
                                <HBox alignItems="Center" class="sapUiSmallMarginBeginEnd">
                                    <VBox class="sapUiSmallMarginEnd">
                                        <Text text="{editModel>key}" class="sapUiTinyMarginBottom" />
                                        <ObjectStatus title="{editModel>value}" state="Indication06" />
                                    </VBox>
                                    <Button
                                        icon="sap-icon://delete"
                                        type="Transparent"
                                        press=".onRemoveProperty" />
                                </HBox>
                            </CustomListItem>
                        </List>

                        <core:Title text="{i18n>editPresentationFilesTitle}" />
                        <Label text="Archivos" />

                        <u:FileUploader
                            id="editFileUploader"
                            name="fileUploader"
                            multiple="true"
                            fileType="jpg,jpeg,png,gif,pdf,doc,docx,xls,xlsx,mp4"
                            change=".onFileChange"
                            buttonText="Subir Archivos"
                            buttonOnly="true"
                            icon="sap-icon://upload" />

                        <List
                            class="sapUiSmallMarginTop"
                            items="{editModel>/files}"
                            noDataText="{i18n>editPresentationNoFilesText}">
                            <CustomListItem>
                                <HBox alignItems="Center" justifyContent="SpaceBetween" class="sapUiTinyMargin">
                                    <HBox alignItems="Center">
                                        <!-- Si es imagen, muestra miniatura -->
                                        <Image
                                            src="{editModel>FILE}"
                                            width="48px"
                                            height="48px"
                                            class="sapUiTinyMarginEnd"
                                            visible="{= ${editModel>FILETYPE} === 'IMG' }" />
                                        <!-- Si NO es imagen, muestra icono genérico -->
                                        <core:Icon
                                            src="{= ${editModel>FILETYPE} === 'IMG'
                                                ? 'sap-icon://picture'
                                                : (${editModel>FILETYPE} === 'PDF'
                                                    ? 'sap-icon://pdf-attachment'
                                                    : 'sap-icon://document') }"
                                            class="sapUiTinyMarginEnd"
                                            visible="{= ${editModel>FILETYPE} !== 'IMG' }" />
                                        <Text text="{editModel>originalname}" />
                                        <Label
                                            text="(Principal)"
                                            visible="{editModel>PRINCIPAL}"
                                            class="sapUiTinyMarginBegin"
                                            design="Bold" />
                                    </HBox>

                                    <Button
                                        icon="sap-icon://delete"
                                        type="Transparent"
                                        press=".onRemoveFile" />
                                </HBox>
                            </CustomListItem>
                        </List>

                    </f:content>
                </f:SimpleForm>
            </VBox>
        </content>
    </Page>
</mvc:View>