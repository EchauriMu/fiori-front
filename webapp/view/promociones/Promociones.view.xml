<mvc:View
    controllerName="com.invertions.sapfiorimodinv.controller.promociones.Promociones"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:f="sap.ui.layout.form"
    xmlns:l="sap.ui.layout"
    xmlns:core="sap.ui.core"
>
    <Page
        id="promocionesPage"
        title="Lista de Promociones - {promotionsModel>/totalPromotions} promociones"
        showNavButton="true"
        navButtonPress="onNavBack"
    >
        <headerContent>
            <Button
                text="Ver Calendario"
                icon="sap-icon://calendar"
                type="Emphasized"
                press="onNavigateToCalendar"
            />
        </headerContent>
        <content>
            <VBox class="sapUiMediumMargin">

                            <!-- Tabla de Promociones -->
                            <Table
                                id="promotionsTable"
                                items="{promotionsModel>/promotions}"
                                mode="MultiSelect"
                                class="sapUiSmallMarginTop"
                                width="auto"
                                growing="true"
                                growingThreshold="20"
                                sticky="ColumnHeaders,HeaderToolbar"
                                selectionChange="onSelectionChange"
                            >
                                <headerToolbar>
                                    <OverflowToolbar>
                                        <Label text="Estado:" class="sapUiTinyMarginEnd" />
                                        <Select
                                            selectedKey="{promotionsModel>/statusFilter}"
                                            change="onStatusFilterChange"
                                            width="150px"
                                        >
                                            <core:Item key="all" text="Todas" />
                                            <core:Item key="Activa" text="Activas" />
                                            <core:Item key="Programada" text="Programadas" />
                                            <core:Item key="Expirada" text="Expiradas" />
                                            <core:Item key="Inactiva" text="Inactivas" />
                                        </Select>
                                        <SearchField 
                                            placeholder="Buscar por título, descripción..."
                                            value="{promotionsModel>/searchText}"
                                            search="onSearch"
                                            width="30%"
                                        />
                                        <Button 
                                            text="Nueva Promoción" 
                                            type="Emphasized"
                                            icon="sap-icon://add"
                                            press="onNewPromotion"
                                        />
                                        <ToolbarSpacer />
                                        <Button 
                                            text="Editar" 
                                            icon="sap-icon://edit" 
                                            type="Transparent" 
                                            press="onEditPromotion"
                                            enabled="{= ${promotionsModel>/selectedCount} === 1 }"
                                        />
                                        <Button 
                                            text="Eliminar" 
                                            icon="sap-icon://delete" 
                                            type="Negative"
                                            press="onDeletePromotion"
                                            enabled="{= ${promotionsModel>/selectedCount} > 0 }"
                                        />
                                        <Button 
                                            text="{= ${promotionsModel>/hasActiveSelected} === null ? 'Desactivar/Activar' : (${promotionsModel>/hasActiveSelected} ? 'Desactivar' : 'Activar') }" 
                                            icon="{= ${promotionsModel>/hasActiveSelected} === null ? 'sap-icon://synchronize' : (${promotionsModel>/hasActiveSelected} ? 'sap-icon://decline' : 'sap-icon://accept') }"
                                            type="Transparent"
                                            press="onToggleActivationBulk"
                                            enabled="{= ${promotionsModel>/selectedCount} > 0 }"
                                        />
                                    </OverflowToolbar>
                                </headerToolbar>
                                <columns>
                                    <Column width="12%">
                                        <Text text="ID Promoción" />
                                    </Column>
                                    <Column width="18%">
                                        <Text text="Título" />
                                    </Column>
                                    <Column width="18%">
                                        <Text text="Descripción" />
                                    </Column>
                                    <Column width="10%" hAlign="Center">
                                        <Text text="Descuento" />
                                    </Column>
                                    <Column width="15%">
                                        <Text text="Vigencia" />
                                    </Column>
                                    <Column width="12%">
                                        <Text text="Creado Por" />
                                    </Column>
                                    <Column width="10%" hAlign="Center">
                                        <Text text="Estado" />
                                    </Column>
                                </columns>
                                
                                <items>
                                    <ColumnListItem type="Active" press="onRowPress">
                                        <cells>
                                            <ObjectIdentifier
                                                title="{promotionsModel>IdPromoOK}"
                                                titleActive="true"
                                            />
                                            <Text text="{promotionsModel>Titulo}" wrapping="false" />
                                            <Text 
                                                text="{promotionsModel>Descripcion}" 
                                                wrapping="false"
                                                maxLines="2"
                                            />
                                            <VBox alignItems="Center">
                                                <ObjectNumber
                                                    number="{promotionsModel>DescuentoPorcentaje}"
                                                    unit="%"
                                                    state="Success"
                                                />
                                            </VBox>
                                            <VBox>
                                                <Text 
                                                    text="{path: 'promotionsModel>FechaIni', formatter: '.formatDate'} - {path: 'promotionsModel>FechaFin', formatter: '.formatDate'}" 
                                                />
                                                <ObjectStatus
                                                    text="{path: 'promotionsModel>', formatter: '.getVigenciaStatus'}"
                                                    state="{path: 'promotionsModel>', formatter: '.getVigenciaState'}"
                                                />
                                            </VBox>
                                            <VBox>
                                                <Text text="{promotionsModel>REGUSER}" />
                                                <Text 
                                                    text="{path: 'promotionsModel>REGDATE', formatter: '.formatDate'}" 
                                                    class="sapUiTinyText"
                                                />
                                            </VBox>
                                            <VBox alignItems="Center">
                                                <ObjectStatus 
                                                    text="{path: 'promotionsModel>', formatter: '.getPromotionStatus'}" 
                                                    state="{path: 'promotionsModel>', formatter: '.getPromotionStatusState'}"
                                                />
                                            </VBox>
                                        </cells>
                                    </ColumnListItem>
                                </items>
                            </Table>

                            <!-- Footer con estadísticas -->
                            <Panel class="sapUiMediumMarginTop">
                                <HBox justifyContent="SpaceBetween" class="sapUiSmallMargin">
                                    <VBox>
                                        <Text text="Activas: {promotionsModel>/activePromotions}" class="sapUiSmallMarginEnd" />
                                    </VBox>
                                    <VBox>
                                        <Text text="Promedio Descuento: {promotionsModel>/averageDiscount}%" />
                                    </VBox>
                                </HBox>
                            </Panel>
                        </VBox>
        </content>
    </Page>
</mvc:View>