<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.ui.layout.form">

    <Dialog
        id="idProductosListaDialog"
        title="Productos y Presentaciones"
        type="Message"
        contentWidth="1100px"
        contentHeight="75vh">

        <content>
            <VBox class="sapUiSmallMargin">

                <!-- Encabezado -->
                <Title level="H3" text="{detailView>/DESLISTA}" class="sapUiForceBold sapUiSmallMarginBottom"/>
                <Text text="{= 'Total de SKUs: ' + ${detailView>/SKUSIDS/length}}" class="sapUiSmallText sapUiGreyText sapUiSmallMarginBottom"/>

                <!-- Buscador -->
                <HBox alignItems="Center" class="sapUiSmallMarginBottom">
                    <SearchField
                        placeholder="Buscar por producto o SKU..."
                        value="{detailView>/searchSKU}"
                        width="350px"
                        liveChange=".onSearchProductos"/>
                </HBox>

                <!-- Loading -->
                <VBox
                    visible="{detailView>/loadingProductos}"
                    alignItems="Center"
                    justifyContent="Center"
                    height="200px">
                    <BusyIndicator busy="true"/>
                    <Text text="Cargando productos..." class="sapUiSmallMarginTop"/>
                </VBox>

                <!-- Error Message -->
                <MessageStrip
                    text="{detailView>/errorProductos}"
                    type="Error"
                    showCloseButton="false"
                    visible="{detailView>/errorProductos}"
                    class="sapUiSmallMarginBottom"/>

                <!-- Productos List -->
                <List
                    items="{detailView>/productosLista}"
                    visible="{= ${detailView>/productosLista}.length > 0}"
                    class="sapUiSmallMarginBottom">

                    <CustomListItem>
                        <VBox width="100%" class="sapUiSmallMargin">
                            <!-- Producto expandible -->
                            <Panel
                                expandable="true"
                                expanded="false"
                                headerText="{detailView>/SKUID} - {detailView>/PRODUCTNAME}"
                                width="100%">

                                <content>
                                    <VBox class="sapUiSmallMargin">
                                        <!-- Info General del Producto -->
                                        <f:SimpleForm layout="ResponsiveGridLayout" editable="false" class="sapUiSmallMarginBottom">
                                            <f:content>
                                                <Label text="SKU"/>
                                                <Text text="{detailView>/SKUID}"/>

                                                <Label text="Nombre"/>
                                                <Text text="{detailView>/PRODUCTNAME}"/>

                                                <Label text="Marca"/>
                                                <Text text="{detailView>/MARCA}"/>
                                            </f:content>
                                        </f:SimpleForm>

                                        <!-- Presentaciones -->
                                        <Panel
                                            headerText="Presentaciones"
                                            expandable="true"
                                            expanded="true"
                                            width="100%">

                                            <content>
                                                <List
                                                    items="{detailView>/presentaciones}"
                                                    noDataText="Sin presentaciones registradas">
                                                    <StandardListItem
                                                        title="{detailView>/IdPresentaOK}"
                                                        description="{detailView>/Presentacion}"
                                                        type="Navigation"/>
                                                </List>
                                            </content>
                                        </Panel>
                                    </VBox>
                                </content>
                            </Panel>
                        </VBox>
                    </CustomListItem>
                </List>

                <!-- Sin productos -->
                <MessageStrip
                    text="No hay productos registrados en esta lista"
                    type="Information"
                    showCloseButton="false"
                    visible="{= ${detailView>/productosLista}.length === 0 &amp;&amp; !${detailView>/loadingProductos}}"/>

            </VBox>
        </content>

        <beginButton>
            <Button
                text="Cerrar"
                press=".onCloseProductosDialog"/>
        </beginButton>
    </Dialog>
</core:FragmentDefinition>
